"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("core-js/modules/esnext.async-iterator.for-each.js"),require("core-js/modules/esnext.async-iterator.reduce.js"),require("core-js/modules/esnext.iterator.constructor.js"),require("core-js/modules/esnext.iterator.for-each.js"),require("core-js/modules/esnext.iterator.reduce.js");var _PseudoEvent=_interopRequireDefault(require("./PseudoEvent")),_PseudoEventListener=_interopRequireDefault(require("./PseudoEventListener")),_Stack=_interopRequireDefault(require("collect-your-stuff/dist/collections/stack/Stack"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}class PseudoEventTarget{constructor(){this.listeners={},this.defaultEvent={}}runEvents(e){if(!(e.type in this.listeners))return!0;this.listeners[e.type];let t=null;if(this.listeners[e.type].empty())return t;let s=this.listeners[e.type].top();if(null===s)return t;if(e.inner.immediatePropagationStopped||s.task.rejectEvent(e))return t;const r=new _Stack.default;for(s=this.listeners[e.type].pop();null!==s;){if(t=s.task.handleEvent(e),s.data.once)return s.task;if(r.push(s),s=this.listeners[e.type].top(),null===s)return t;if(e.inner.immediatePropagationStopped||s.task.rejectEvent(e))return t;s=this.listeners[e.type].pop()}if(!r.empty()){let t=r.pop();for(;null!==t;)this.listeners[e.type].push(t)}return t}setDefaultEvent(e,t){e in this.listeners||(this.listeners[e]=new _Stack.default),this.defaultEvent[e]=t}runDefaultEvent(e){if(e.defaultPrevented)return!1;this.defaultEvent[e.type](e)}startEvents(e){const t=new _PseudoEvent.default(e);return t.inner.target=this,console.log("startEvents",t.type,t.target),[_PseudoEvent.default.CAPTURING_PHASE,_PseudoEvent.default.AT_TARGET,_PseudoEvent.default.BUBBLING_PHASE].forEach((s=>{let r=null;s!==_PseudoEvent.default.AT_TARGET&&t.inner.propagationStopped||(t.inner.eventPhase=s,t.composedPath().forEach((e=>{t.inner.currentTarget=e,r=t.currentTarget.runEvents(t)}))),t.eventPhase===_PseudoEvent.default.AT_TARGET&&"boolean"!=typeof r&&this.defaultEvent[e]&&this.runDefaultEvent(t)})),!0}addEventListener(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={capture:!1,once:!1,passive:!1};"object"==typeof s?r=Object.keys(s).reduce(((e,t)=>(e[t]=s[t],e)),r):r.capture=s,e in this.listeners||(this.listeners[e]=new _Stack.default);const n=new _PseudoEventListener.default(e,r,(t.handleEvent||t).bind(this));this.listeners[e].push(n);const i=[],u=[];let l=this.listeners[e].pop();for(;null!==l;)l.task.isDefault?i.push(l):u.push(l),l=this.listeners[e].pop();this.listeners[e]=_Stack.default.fromArray([].concat(u,i))}removeEventListener(e,t){if(!(e in this.listeners))return;let s=this.listeners[e].pop();const r=[];for(;null!==s;){const e=s.task;(e.handleEvent!==t||e.isDefault)&&r.push(s)}this.listeners[e]=_Stack.default.fromArray(r)}dispatchEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return e.inner.target=t,!(e.type in this.listeners)||(this.runEvents(e),!e.defaultPrevented)}}var _default=exports.default=PseudoEventTarget;