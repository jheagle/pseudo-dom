"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("core-js/modules/esnext.async-iterator.reduce.js"),require("core-js/modules/esnext.iterator.constructor.js"),require("core-js/modules/esnext.iterator.reduce.js"),require("core-js/modules/esnext.async-iterator.for-each.js"),require("core-js/modules/esnext.iterator.for-each.js");var _PseudoEvent=_interopRequireDefault(require("./PseudoEvent")),_PseudoEventListener=_interopRequireDefault(require("./PseudoEventListener"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}class PseudoEventTarget{constructor(){this.listeners=[],this.defaultEvent=[]}runEvents(e){if(!(e.type in this.listeners))return!0;const t=this.listeners[e.type];let s=null;return this.listeners[e.type]=t.reduce(((t,n)=>e.immediatePropagationStopped||n.rejectEvent(e)?t.concat(n):(s=n.handleEvent(e),n.eventOptions.once?(e.currentTarget.removeEventListener(e.eventType,e.handleEvent),t):t.concat(n))),[]),s}setDefaultEvent(e,t){e in this.listeners||(this[e]=()=>this.startEvents(e),this.listeners[e]=[]),this.defaultEvent[e]=t}runDefaultEvent(e){if(e.defaultPrevented)return!1;this.defaultEvent[e.type](e)}startEvents(e){const t=new _PseudoEvent.default(e);return t.setReadOnlyProperties({target:this}),console.log("startEvents",t.type,t.target),[_PseudoEvent.default.CAPTURING_PHASE,_PseudoEvent.default.AT_TARGET,_PseudoEvent.default.BUBBLING_PHASE].forEach((s=>{let n=null;s!==_PseudoEvent.default.AT_TARGET&&t.propagationStopped||(t.setReadOnlyProperties({eventPhase:s}),t.composedPath().forEach((e=>{t.setReadOnlyProperties({currentTarget:e}),n=t.currentTarget.runEvents(t)}))),t.eventPhase===_PseudoEvent.default.AT_TARGET&&"boolean"!=typeof n&&this.defaultEvent[e]&&this.runDefaultEvent(t)})),!0}addEventListener(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n={capture:!1,once:!1,passive:!1};"object"==typeof s?n=Object.keys(s).reduce(((e,t)=>(e[t]=s[t],e)),n):n.capture=s,e in this.listeners||(this[e]=()=>this.startEvents(e),this.listeners[e]=[]),this.listeners[e]=this.listeners[e].concat([Object.assign(Object.create(_PseudoEventListener.default),_PseudoEventListener.default,{eventType:e,eventOptions:Object.assign({},_PseudoEventListener.default.eventOptions,n),handleEvent:(t.handleEvent||t).bind(this)})]);const r=this.listeners[e].reduce(((e,t)=>t.isDefault?Object.assign({},e,{default:e.default.concat([t])}):Object.assign({},e,{explicit:e.explicit.concat([t])})),{explicit:[],default:[]});this.listeners[e]=[].concat(r.explicit,r.default)}removeEventListener(e,t){if(!(e in this.listeners))return;const s=this.listeners[e];for(let e=0,n=s.length;e<n;e++)if(s[e].handleEvent===t&&!s[e].isDefault)return void s.splice(e,1)}dispatchEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return e.setReadOnlyProperties({target:t}),!(e.type in this.listeners)||(this.runEvents(e),!e.defaultPrevented)}}var _default=exports.default=PseudoEventTarget;